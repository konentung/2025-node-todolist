extends ../layout

block content
  .d-flex.justify-content-between.align-items-center.mb-4
    h2
      i.bi.bi-list-task.me-2
      | 我的待辦事項
    a.btn.btn-success(href='/todos/new')
      i.bi.bi-plus-circle.me-2
      | 新增待辦事項

  if todos.length === 0
    .text-center.py-5
      i.bi.bi-inbox.display-1.text-muted.mb-3
      h4.text-muted 還沒有待辦事項
      p.text-muted 點擊上方按鈕開始新增您的第一個待辦事項
  else
    .row
      each todo in todos
        .col-md-6.col-lg-4.mb-3
          .card.h-100(class=todo.completed ? 'border-success' : '')
            .card-body
              .d-flex.justify-content-between.align-items-start.mb-2
                h5.card-title.mb-0(class=todo.completed ? 'text-decoration-line-through text-muted' : '')
                  a.text-decoration-none(href='/todos/' + todo._id, class=todo.completed ? 'text-muted' : 'text-dark')
                    | #{todo.title}
                .dropdown
                  button.btn.btn-sm.btn-outline-secondary.dropdown-toggle(type='button', data-bs-toggle='dropdown')
                    i.bi.bi-three-dots
                  ul.dropdown-menu
                    li
                      a.dropdown-item.toggle-complete(href='#', data-id=todo._id)
                        if todo.completed
                          i.bi.bi-x-circle.me-2
                          | 標記為未完成
                        else
                          i.bi.bi-check-circle.me-2
                          | 標記為完成
                    li
                      a.dropdown-item(href='/todos/' + todo._id + '/edit')
                        i.bi.bi-pencil.me-2
                        | 編輯
                    li
                      hr.dropdown-divider
                    li
                      a.dropdown-item.text-danger.delete-todo(href='#', data-id=todo._id)
                        i.bi.bi-trash.me-2
                        | 刪除
              
              if todo.description
                p.card-text.text-muted.small #{todo.description}
              
              .d-flex.justify-content-between.align-items-center.mt-3
                small.text-muted
                  i.bi.bi-calendar.me-1
                  | #{new Date(todo.createdAt).toLocaleDateString('zh-TW')}
                
                if todo.completed
                  span.badge.bg-success
                    i.bi.bi-check-circle.me-1
                    | 已完成
                else
                  span.badge.bg-warning
                    i.bi.bi-clock.me-1
                    | 進行中
